{% extends "payments/base.html" %}

{% block title %}Pay your order{% endblock %}

{% block content %}
  <h1>Order summary</h1>
  <ul>
    {% for item in order.items.all %}
      <li>
        <p>Product: {{ item.item.name }}</p>
        <p>Price: {{ item.price }} {{ item.item.currency }}</p>
        <p>Quantity: {{ item.quantity }}</p>
        <p>Total: {{ item.get_cost }} ₽</p>
      </li>
    {% endfor %}
  </ul>
    {% if order.tax.exists %}
          <p><b>Taxes:</b></p>
            <p>{% for tax in order.tax.all %}
               {{ tax.name }} ({{ tax.rate }}%): ₽{{ order.get_total_tax|floatformat:2 }}
               {% endfor %}</p>
      {% endif %}

      {% if order.coupon %}
          <p><b>Discount:</b></p>
            <p>"{{ order.coupon.code }}" coupon
               ({{ order.discount }}% off)
               – ₽{{ order.get_discount|floatformat:2 }}</p>
      {% endif %}

  <b>Overall:</b> {{ order.get_total_cost|floatformat:2 }} ₽
  <form action="{% url 'payment:buy_order' %}" method="post">
    <input type="submit" value="Pay now">
    {% csrf_token %}
  </form>

  <form action="{% url 'payment:buy_order_intent' %}" method="post">
    {% csrf_token %}
    <button type="submit">Pay now with PaymentIntent</button>
  </form>
{% endblock %}